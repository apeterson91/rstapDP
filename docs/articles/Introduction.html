<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction • rstapDP</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="rstapDP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstapDP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/Longitudinal_Models.html">Longitudinal Models</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/apeterson91/rstapDP/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/apeterson91/rstapDP/blob/master/vignettes/Introduction.Rmd"><code>vignettes/Introduction.Rmd</code></a></small>
      <div class="hidden name"><code>Introduction.Rmd</code></div>

    </div>

    
    
<div id="motivation" class="section level1">
<h1 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h1>
<p>The <a href="https://biostatistics4socialimpact.github.io/rstap"><code>rstap</code></a> and <a href="https://apeterson91.github.io/rsstap"><code>rsstap</code></a> packages introduced Spatial Temporal Aggregated Predictor (STAP) models for estimating the effect of spatio-temporal exposure to nearby Built Environment Features (BEFs) on human health. The effects estimated in those models were homogenous; It was assumed in the model formulation that all individuals have the same effect of living near a BEF.The <code>rstapDP</code> package removes this assumption by allowing for heterogeneity in the STAP effect across the population.</p>
<div id="illustrative-example" class="section level2">
<h2 class="hasAnchor">
<a href="#illustrative-example" class="anchor"></a>Illustrative Example</h2>
<p>For example, consider a sample of individuals <span class="math inline">\((i=1,...,n)\)</span> near Fast Food Restaurants (FFRs) where half of the subjets are at “high risk”of having an average increase in their BMI as a consequence of living near the FFR. In contrast the other half of the population are “low risk” as they experience no increase in BMI. Identifying these effects without knowing these individuals’ risk status, or the number of risk populations requires the estimation of some number of STAP effects <span class="math inline">\(f_i(\mathcal{D}_i)\)</span> where <span class="math inline">\(f(\cdot)\)</span> is the (say) spatial exposure function relating how the average health outcome <span class="math inline">\(BMI_i\)</span> increases as a function of where a new FFR is placed relative to the subjects.</p>
<p>The STAP-DP model which <code>rstapDP</code> incorporates these ideas in a regression setting as follows assuming covariate informatino <span class="math inline">\(Z_i\)</span> (e.g. sex and/or an intercept term) is also available:</p>
<p><span class="math display">\[
E[BMI_i] =  \mathbf{Z}_i^{T} \mathbf{\delta} + f_i(\mathcal{D}_i) \quad i = 1,...,n.
\]</span></p>
<p>Above, <span class="math inline">\(f_i(\mathcal{D})\)</span>, the smooth function of BEF exposure is modeled through spline regression coefficients, <span class="math inline">\(\mathbf{\beta}_i\)</span> similar to the <code>rsstap</code> package. In the <code>rstapDP</code> package, we place a Dirichlet Process (DP) prior on these regression coefficients:</p>
<p><span class="math display">\[
f_i(\mathcal{D}_i) = \sum_{j=0}^{J}\sum_{d \in \mathcal{D}_i} \beta_{i,j}\phi_j(d)\\
(\mathbf{\beta}_i,\mathbf{\tau}_i)  \sim  DP(\alpha,G_0)\\
G_0 \equiv MVN(0,\mathbf{I}\sigma^{-2} \mathbf{\tau}_i)\times \text{Gamma}(a_{\tau},b_{\tau})\\
\alpha \sim \text{Gamma}(a_{\alpha},b_{\alpha}).
\]</span></p>
<p>By placing a DP prior on the <span class="math inline">\(\mathbf{\beta}\)</span> coefficients, heterogenous effects clustering is induced, allowing for the estimation of the aforementioned high/low risk spatial exposure effects.</p>
<p>In the following sections, this idea will be briefly illustrated using the simple simulated example. For more information, check out the <code>rstapDP</code> <a href="https://apeterson91.github.io/rstapDP/reference/index.html">documentation</a>.</p>
</div>
<div id="exploratory-data-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#exploratory-data-analysis" class="anchor"></a>Exploratory Data Analysis</h2>
<p>We’ll begin by loading the appropriate libaries.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rbenvo</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rstapDP</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>())
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"FFR_benvo"</span>)</pre></body></html></div>
<p>For this simple illustrative example, we’ll use the data <code>FFR_benvo</code> (see <a href="https://apeterson91.github.io/rbenvo/">here</a> for more information on <code>benvos</code>) which comes with the <code>rstapDP</code> package. This data is simulated in the manner previously described: with one high risk group that experiences an increase in the pseudo-BMI measure as a function of nearby FFRs, and one group that does not. There is also a binary sex covariate simulated. We can get a brief description of the FFR data by calling the print and summary functions of the <code>FFR_benvo</code> object.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">FFR_benvo</span>
<span class="co">#&gt; Subject Data:</span>
<span class="co">#&gt; ---------------------------:</span>
<span class="co">#&gt; Observations:  1000</span>
<span class="co">#&gt; Columns:  3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; BEF Data:</span>
<span class="co">#&gt; ---------------------------:</span>
<span class="co">#&gt; Number of Features:  1</span>
<span class="co">#&gt; Features: </span>
<span class="co">#&gt;   Name Measures</span>
<span class="co">#&gt; 1  FFR Distance</span></pre></body></html></div>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rbenvo/man/bef_summary.html">bef_summary</a></span>(<span class="no">FFR_benvo</span>)
<span class="co">#&gt; # A tibble: 1 x 7</span>
<span class="co">#&gt; # Groups:   BEF [1]</span>
<span class="co">#&gt;   BEF   Distance_Time  Lower Median Upper Number Num_NA</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1 FFR   Distance      0.0278  0.504 0.975   9501      0</span></pre></body></html></div>
</div>
<div id="model-fitting-and-results" class="section level2">
<h2 class="hasAnchor">
<a href="#model-fitting-and-results" class="anchor"></a>Model Fitting and Results</h2>
<p>The following syntax shows how to fit the STAP-DP model. The <code>rstapDP</code>package fits the above model using a truncated DP Gibbs Sampler via <code>Rcpp</code>. We’ll use the default prior recommendations for the DP base measure and prior precision, drawing 5000 samples with the first 3000 used for burn in. Note that more/fewer iterations may be required depending on the complexity or size of the data.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fdp_staplm.html">fdp_staplm</a></span>(<span class="no">BMI</span> ~ <span class="no">sex</span> + <span class="fu">sap</span>(<span class="no">FFR</span>),
                  <span class="kw">benvo</span> <span class="kw">=</span> <span class="no">FFR_benvo</span>,
                  <span class="kw">K</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="co">## for speed</span>
                  <span class="kw">iter_max</span> <span class="kw">=</span> <span class="fl">3E3</span>,
                  <span class="kw">burn_in</span> <span class="kw">=</span> <span class="fl">2E3</span>,
                  <span class="kw">thin</span> <span class="kw">=</span> <span class="fl">1</span>,
                  <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">43431</span>)</pre></body></html></div>
<p>With our model fitting complete, our first check will be to look the posterior predictive checks via the <code>ppc</code> function.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/ppc.html">ppc</a></span>(<span class="no">fit</span>)</pre></body></html></div>
<p><img src="Introduction_files/figure-html/ppcs-1.png" width="700"></p>
<p>An additional graphical check that can be used to identify clustering patterns is the pairwise probability matrix as described in <span class="citation">(Rodriguez 2012, 1136)</span></p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_pairs.html">plot_pairs</a></span>(<span class="no">fit</span>,<span class="kw">sample</span><span class="kw">=</span><span class="fl">500</span>,<span class="kw">sort</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="co">#&gt; Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.</span>
<span class="co">#&gt; Using compatibility `.name_repair`.</span>
<span class="co">#&gt; This warning is displayed once every 8 hours.</span>
<span class="co">#&gt; Call `lifecycle::last_warnings()` to see where this warning was generated.</span></pre></body></html></div>
<p><img src="Introduction_files/figure-html/pairs-1.png" width="700"></p>
<p>Finally, we’ll take at look at the estimated and true exposure curves.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">fit</span>) + <span class="no">truth</span></pre></body></html></div>
<p><img src="Introduction_files/figure-html/effects-1.png" width="700"></p>
<p>The curves themselves, including the distance at which the exposure effect becomes negligible, in addition to the proportion with which individuals are assigned to these curves are the typical primary objectives for those interested in this model. However, we empahsize the importance of using the posterior predictive checks and diagnostics prior to reading too much into any curve or parameter estimates.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-rodriguez">
<p>Rodriguez, Abel. 2012. “Nested Dirichlet Process.” <em>Journal of the American Statistical Association</em> 103 (483): 1131–54. <a href="https://doi.org/10.1198/016214508000000553">https://doi.org/10.1198/016214508000000553</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Adam Peterson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
